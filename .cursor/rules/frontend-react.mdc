---
description: 前端 React / TypeScript / TanStack Router 组件与路由规则
globs: apps/web/src/**/*
alwaysApply: false
---

## Frontend React / TypeScript / Router 规则

本文件用于指导 Cursor 在 `apps/web` 中编写和修改前端 React 代码时遵循本项目约定与官方最佳实践。

- 适用范围：`apps/web/src` 下的 `main.tsx`、`routes/*`、`components/*`、`hooks/*` 等。
- 优先级：当与通用前端规则冲突时，以本文件为准。

### 技术栈与总体约定

- 使用 **React 19** 函数组件 + Hooks，禁止 class 组件。
- 使用 **TypeScript 严格模式**，避免 `any`；配合 ESLint 规则。
- 路由使用 **TanStack Router** 文件路由，禁止 `react-router`。
- 样式使用 **Tailwind CSS** + `clsx` + `class-variance-authority`，避免 CSS-in-JS。

### 应用入口与 Router

- 入口文件 `main.tsx` 约定：
  - 使用 `createRouter({ routeTree })` 创建 Router，`routeTree` 来自 `routeTree.gen.ts`。
  - 使用 `RouterProvider` 包裹应用。
- Root Route：
  - 在 `routes/__root.tsx` 使用 `createRootRoute` 定义根布局（导航栏 + `Outlet`）。
  - 如需调试，使用 `TanStackRouterDevtools`。

### 文件路由约定（TanStack Router）

- 所有页面组件应放在 `src/routes` 下，以文件名代表路由：
  - `index.tsx` → `/`
  - `about.tsx` → `/about`
  - `users.tsx` → `/users`
  - 动态参数如用户详情可使用 `$userId.tsx` 等形式。
- 在每个路由文件中：
  - 导出 `Route` 常量：
    - `export const Route = createFileRoute("...")({ component: ... })`
  - 路由内部组件只在该文件中定义或从 `components` 中复用。

### 组件与 UI 约定

#### shadcn/ui 组件使用规范

**组件分层架构**：
- **基础层** (`src/components/ui/*`): shadcn/ui 官方组件，保持原样或最小修改
- **扩展层** (`src/components/ui/extensions/*`): UI 组件的扩展版本（包装组件）
- **业务层** (`src/components/*`): 基于 UI 组件的业务组件
- **页面层** (`src/routes/*`): 使用业务组件构建页面

**组件使用原则**：
- ✅ **优先使用** `@/components/ui` 中的基础组件
- ✅ **通过 `className` prop 扩展样式**，而非修改组件源码
- ✅ **需要大量自定义时**，创建包装组件在 `components/ui/extensions/` 或 `components/` 目录
- ✅ **所有组件必须使用 `cn()` 工具函数**合并类名
- ✅ **禁止直接修改** `src/components/ui/*` 中的组件源码（除非记录变更日志）

**组件自定义规范**：
- ✅ **最小修改原则**: 优先通过 `className` prop 扩展样式
- ✅ **扩展而非修改**: 创建包装组件而非修改原始组件
- ✅ **变更文档**: 所有自定义修改必须在组件文件顶部记录（使用 JSDoc `@changelog`）
- ✅ **API 兼容**: 组件 props 接口保持向后兼容
- ✅ **样式兼容**: 使用 CSS 变量而非硬编码颜色值
- ✅ **遵循设计模式**: 使用 forwardRef、displayName 等 shadcn/ui 标准模式

**组件更新流程**：
1. **备份当前组件文件**（如果已自定义）
2. **使用 CLI 更新**: `npx shadcn@latest add [component] --overwrite`
3. **手动合并自定义修改**到新版本
4. **更新组件文件顶部的变更日志**（`@changelog` 部分）
5. **测试所有使用该组件的页面**

**组件变更日志模板**：
```typescript
/**
 * @fileoverview [Component] component from shadcn/ui
 * @source https://ui.shadcn.com/docs/components/[component]
 * @style new-york
 * @baseColor zinc
 *
 * @changelog
 * - YYYY-MM-DD: [变更描述]
 *   - [具体修改内容]
 *   - [迁移说明]
 *
 * @usage
 * ```tsx
 * import { [Component] } from "@/components/ui/[component]"
 * ```
 *
 * @note
 * - To customize: Use className prop or create wrapper component
 * - To update: Run `npx shadcn@latest add [component] --overwrite`
 * - Remember to merge any custom changes after update
 */
```

**配置管理**：
- ✅ `components.json` 配置变更需团队评审
- ✅ 确保 `style`、`baseColor`、`iconLibrary` 在所有环境中一致
- ✅ Tailwind 配置变更需同步更新 CSS 变量
- ✅ 使用 CSS 变量系统（`--color-*`）支持主题切换

**新组件添加检查清单**：
- [ ] 检查 shadcn/ui 是否有官方组件
- [ ] 确认 `components.json` 配置正确
- [ ] 使用 CLI 添加组件：`npx shadcn@latest add [component]`
- [ ] 在组件文件顶部添加变更日志模板
- [ ] 验证组件在项目中正常工作

#### 通用组件约定

- 新组件：
  - 放在 `components/` 下，按功能子目录划分（未来扩展时遵守此约定）。
  - 使用 Tailwind 工具类，不单独引入 styled-components/emotion 等库。

### Hooks 使用规范

- 将通用逻辑抽离为自定义 Hooks 放在 `src/hooks` 下（例如 `useUsers`、`useCounter`）。
- 副作用（数据获取、订阅、计时器等）放在 Hook 中，而不是直接写在组件渲染逻辑里。

